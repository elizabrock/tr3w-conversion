<?xml version="1.0" encoding="UTF-8"?>
<office:document-content xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:rdfa="http://docs.oasis-open.org/opendocument/meta/rdfa#" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" office:version="1.2"><office:scripts/><office:font-face-decls><style:font-face style:name="Symbol" svg:font-family="Symbol" style:font-pitch="variable" style:font-charset="x-symbol"/><style:font-face style:name="Wingdings" svg:font-family="Wingdings" style:font-pitch="variable" style:font-charset="x-symbol"/><style:font-face style:name="Tahoma1" svg:font-family="Tahoma"/><style:font-face style:name="Lucida Grande1" svg:font-family="&apos;Lucida Grande&apos;" style:font-family-generic="swiss"/><style:font-face style:name="B Courier Bold" svg:font-family="&apos;B Courier Bold&apos;, &apos;Times New Roman&apos;" style:font-pitch="variable"/><style:font-face style:name="Courier" svg:font-family="Courier" style:font-pitch="variable"/><style:font-face style:name="Courier New" svg:font-family="&apos;Courier New&apos;" style:font-pitch="variable"/><style:font-face style:name="Lucida Grande" svg:font-family="&apos;Lucida Grande&apos;" style:font-pitch="variable"/><style:font-face style:name="Courier New1" svg:font-family="&apos;Courier New&apos;" style:font-family-generic="modern" style:font-pitch="variable"/><style:font-face style:name="AGaramond Italic" svg:font-family="&apos;AGaramond Italic&apos;, &apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable"/><style:font-face style:name="AGaramond Semibold" svg:font-family="&apos;AGaramond Semibold&apos;, &apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable"/><style:font-face style:name="AGaramond" svg:font-family="AGaramond, &apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable"/><style:font-face style:name="BI Courier BoldOblique" svg:font-family="&apos;BI Courier BoldOblique&apos;, &apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable"/><style:font-face style:name="Stone Sans Semibold" svg:font-family="&apos;Stone Sans Semibold&apos;, &apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable"/><style:font-face style:name="Stone Sans" svg:font-family="&apos;Stone Sans&apos;, &apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable"/><style:font-face style:name="Times New Roman" svg:font-family="&apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable"/><style:font-face style:name="Arial" svg:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable"/><style:font-face style:name="Helvetica" svg:font-family="Helvetica" style:font-family-generic="swiss" style:font-pitch="variable"/><style:font-face style:name="Arial Unicode MS" svg:font-family="&apos;Arial Unicode MS&apos;" style:font-family-generic="system" style:font-pitch="variable"/><style:font-face style:name="MS Mincho" svg:font-family="&apos;MS Mincho&apos;" style:font-family-generic="system" style:font-pitch="variable"/><style:font-face style:name="Tahoma" svg:font-family="Tahoma" style:font-family-generic="system" style:font-pitch="variable"/></office:font-face-decls><office:automatic-styles><style:style style:name="P1" style:family="paragraph" style:parent-style-name="TB"><style:paragraph-properties><style:tab-stops><style:tab-stop style:position="1.2252in"/><style:tab-stop style:position="1.4862in"/><style:tab-stop style:position="2in"/><style:tab-stop style:position="2.2846in"/><style:tab-stop style:position="2.5in"/><style:tab-stop style:position="3in"/><style:tab-stop style:position="3.1453in"/><style:tab-stop style:position="3.5in"/><style:tab-stop style:position="4in"/><style:tab-stop style:position="4.139in"/><style:tab-stop style:position="4.5in"/><style:tab-stop style:position="5in"/></style:tab-stops></style:paragraph-properties><style:text-properties fo:font-size="8.5pt" style:font-size-asian="8.5pt"/></style:style><style:style style:name="P2" style:family="paragraph" style:parent-style-name="IT"><style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/></style:style><style:style style:name="P3" style:family="paragraph" style:parent-style-name="BX"><style:paragraph-properties fo:margin-left="0.3752in" fo:margin-right="0in" fo:text-indent="-0.25in" style:auto-text-indent="false"/></style:style><style:style style:name="P4" style:family="paragraph" style:parent-style-name="CDT1"><style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/></style:style><style:style style:name="P5" style:family="paragraph" style:parent-style-name="CDT"><style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/></style:style><style:style style:name="P6" style:family="paragraph" style:parent-style-name="CDTX"><style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/></style:style><style:style style:name="P7" style:family="paragraph" style:parent-style-name="TIX"><style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0.2083in"/></style:style><style:style style:name="P8" style:family="paragraph" style:parent-style-name="IT" style:list-style-name="WW8Num1"/><style:style style:name="P9" style:family="paragraph" style:parent-style-name="IT"><style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/></style:style><style:style style:name="P10" style:family="paragraph" style:parent-style-name="CDT1"><style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/></style:style><style:style style:name="P11" style:family="paragraph" style:parent-style-name="CDT"><style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/></style:style><style:style style:name="P12" style:family="paragraph" style:parent-style-name="CDTX"><style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/></style:style><style:style style:name="P13" style:family="paragraph" style:parent-style-name="BX"><style:paragraph-properties fo:margin-left="0.3752in" fo:margin-right="0in" fo:text-indent="-0.25in" style:auto-text-indent="false"/></style:style><style:style style:name="P14" style:family="paragraph" style:parent-style-name="TIX"><style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0.2083in"/></style:style><style:style style:name="P15" style:family="paragraph" style:parent-style-name="Contents_20_1" style:master-page-name="Standard"><style:paragraph-properties style:page-number="auto"><style:tab-stops><style:tab-stop style:position="5.6665in" style:type="right" style:leader-style="dotted" style:leader-text="."/></style:tab-stops></style:paragraph-properties></style:style><style:style style:name="P16" style:family="paragraph" style:parent-style-name="Contents_20_2"><style:paragraph-properties><style:tab-stops><style:tab-stop style:position="5.6665in" style:type="right" style:leader-style="dotted" style:leader-text="."/></style:tab-stops></style:paragraph-properties></style:style><style:style style:name="P17" style:family="paragraph" style:parent-style-name="Contents_20_3"><style:paragraph-properties><style:tab-stops><style:tab-stop style:position="5.6665in" style:type="right" style:leader-style="dotted" style:leader-text="."/></style:tab-stops></style:paragraph-properties></style:style><style:style style:name="P18" style:family="paragraph" style:parent-style-name="TB"><style:paragraph-properties><style:tab-stops><style:tab-stop style:position="1.2252in"/><style:tab-stop style:position="1.4862in"/><style:tab-stop style:position="2in"/><style:tab-stop style:position="2.2846in"/><style:tab-stop style:position="2.5in"/><style:tab-stop style:position="3in"/><style:tab-stop style:position="3.1453in"/><style:tab-stop style:position="3.5in"/><style:tab-stop style:position="4in"/><style:tab-stop style:position="4.139in"/><style:tab-stop style:position="4.5in"/><style:tab-stop style:position="5in"/></style:tab-stops></style:paragraph-properties><style:text-properties fo:font-size="8.5pt" style:font-size-asian="8.5pt"/></style:style><style:style style:name="P19" style:family="paragraph" style:parent-style-name="Standard"><style:paragraph-properties><style:tab-stops><style:tab-stop style:position="5.6598in" style:type="right" style:leader-style="dotted" style:leader-text="."/></style:tab-stops></style:paragraph-properties></style:style><style:style style:name="P20" style:family="paragraph"><style:paragraph-properties style:writing-mode="lr-tb"/></style:style><style:style style:name="T1" style:family="text"/><style:style style:name="T2" style:family="text"><style:text-properties style:font-name="AGaramond Italic"/></style:style><style:style style:name="T3" style:family="text"><style:text-properties style:font-name="B Courier Bold" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/></style:style><style:style style:name="T4" style:family="text"><style:text-properties style:font-name="B Courier Bold"/></style:style><style:style style:name="T5" style:family="text"><style:text-properties fo:color="#0000ff" style:font-name="B Courier Bold" fo:font-size="10pt" style:font-size-asian="10pt"/></style:style><style:style style:name="T6" style:family="text"><style:text-properties style:font-name="AGaramond Semibold"/></style:style><style:style style:name="T7" style:family="text"><style:text-properties style:text-position="super 58%"/></style:style><style:style style:name="T8" style:family="text"><style:text-properties style:font-name="AGaramond Italic"/></style:style><style:style style:name="T9" style:family="text"><style:text-properties style:font-name="B Courier Bold"/></style:style><style:style style:name="T10" style:family="text"><style:text-properties style:font-name="B Courier Bold" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/></style:style><style:style style:name="T11" style:family="text"><style:text-properties fo:color="#0000ff" style:font-name="B Courier Bold" fo:font-size="10pt" style:font-size-asian="10pt"/></style:style><style:style style:name="T12" style:family="text"><style:text-properties style:font-name="AGaramond Semibold"/></style:style><style:style style:name="T13" style:family="text"><style:text-properties style:text-position="super 58%"/></style:style><style:style style:name="T14" style:family="text"><style:text-properties style:use-window-font-color="true" style:font-name="Helvetica" fo:font-size="12pt" fo:language="en" fo:country="US" style:font-name-asian="Times New Roman" style:font-size-asian="12pt" style:font-name-complex="Times New Roman" style:font-size-complex="12pt" style:language-complex="ar" style:country-complex="SA"/></style:style><style:style style:name="Sect1" style:family="section"><style:section-properties style:editable="false"><style:columns fo:column-count="1" fo:column-gap="0in"/></style:section-properties></style:style></office:automatic-styles><office:body><office:text text:use-soft-page-breaks="true"><office:forms form:automatic-focus="false" form:apply-design-mode="false"/><text:tracked-changes><text:changed-region text:id="ct533655504"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:11:00</dc:date></office:change-info><text:p text:style-name="FT"><text:span text:style-name="CD1">script/</text:span></text:p></text:deletion></text:changed-region><text:changed-region text:id="ct516710592"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:11:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct532862720"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:35:00</dc:date></office:change-info><text:p text:style-name="FT"><text:span text:style-name="CD1">environment</text:span></text:p></text:deletion></text:changed-region><text:changed-region text:id="ct624251312"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:35:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct533619008"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:53:00</dc:date></office:change-info><text:p text:style-name="FT"><text:span text:style-name="CD1"><text:s/>For instance, take a look at the top of script/</text:span></text:p></text:deletion></text:changed-region><text:changed-region text:id="ct532958688"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:13:00</dc:date></office:change-info><text:p text:style-name="FT"><text:span text:style-name="CD1">generate </text:span></text:p></text:deletion></text:changed-region><text:changed-region text:id="ct535345760"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:53:00</dc:date></office:change-info><text:p text:style-name="FT"><text:span text:style-name="CD1">rails </text:span></text:p></text:deletion><text:insertion><office:change-info office:chg-author="Samer" office:chg-date-time="2010-03-27T15:13:00"/></text:insertion></text:changed-region><text:changed-region text:id="ct534830848"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:53:00</dc:date></office:change-info><text:p text:style-name="FT">in any Rails application:</text:p><text:p text:style-name="C1"/></text:deletion></text:changed-region><text:changed-region text:id="ct532976080"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:53:00</dc:date></office:change-info><text:p text:style-name="C1">ENV_PATH <text:s/>= File.expand_path(&apos;../../config/environment&apos;, <text:s/>__FILE__)</text:p><text:p text:style-name="C1">BOOT_PATH = File.expand_path(&apos;../../config/boot&apos;, <text:s/>__FILE__)</text:p><text:p text:style-name="C1">APP_PATH <text:s/>= File.expand_path(&apos;../../config/application&apos;, <text:s/>__FILE__)</text:p><text:p text:style-name="C1">ROOT_PATH = File.expand_path(&apos;../..&apos;, <text:s/>__FILE__)</text:p><text:p text:style-name="C1">require BOOT_PATH</text:p></text:deletion><text:insertion><office:change-info office:chg-author="Samer" office:chg-date-time="2010-03-27T15:35:00"/></text:insertion></text:changed-region><text:changed-region text:id="ct625038352"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:53:00</dc:date></office:change-info><text:p text:style-name="C1"><text:span text:style-name="CD1"/></text:p><text:p text:style-name="C1"/></text:deletion></text:changed-region><text:changed-region text:id="ct533610896"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:35:00</dc:date></office:change-info><text:p text:style-name="C1">require File.expand_path(&apos;../../config/environment&apos;, <text:s/>__FILE__)</text:p></text:deletion></text:changed-region><text:changed-region text:id="ct624869168"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:48:00</dc:date></office:change-info><text:p text:style-name="IT">Other p</text:p></text:deletion></text:changed-region><text:changed-region text:id="ct532976288"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:48:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct533609344"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:44:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct46013760"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:46:00</dc:date></office:change-info><text:p text:style-name="IT">that need</text:p></text:deletion></text:changed-region><text:changed-region text:id="ct45363712"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:46:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct533100192"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:46:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct625060240"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:47:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct533055456"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:48:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct532957600"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:49:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct532962816"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:49:00</dc:date></office:change-info><text:p text:style-name="IT"><text:span text:style-name="CD1">such as your tests, also require config/environment.rb, hence you’ll notice a similar require statement at the top of files such as test</text:span></text:p></text:deletion></text:changed-region><text:changed-region text:id="ct624757920"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:49:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct532963008"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:49:00</dc:date></office:change-info><text:p text:style-name="IT"><text:span text:style-name="CD1">test</text:span></text:p></text:deletion></text:changed-region><text:changed-region text:id="ct533683552"><text:insertion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:49:00</dc:date></office:change-info></text:insertion></text:changed-region><text:changed-region text:id="ct538565328"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:52:00</dc:date></office:change-info><text:p text:style-name="CDTX"><text:span text:style-name="CD1"/></text:p><text:p text:style-name="HD">application.rb (continued)</text:p><text:p text:style-name="FT">Getting back to application.rb, we find the main configuration of our app, which in Rails 3 gets its own module and class:</text:p><text:p text:style-name="CDT1">module TimeAndExpenses</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>class Application &lt; Rails::Application</text:p><text:p text:style-name="CDT"><text:s text:c="4"/># Settings in config/environments/* take precedence over those</text:p><text:p text:style-name="CDT"><text:s text:c="4"/># specified here. Application configuration should go into files</text:p><text:p text:style-name="CDT"><text:s text:c="4"/># in config/initializers</text:p><text:p text:style-name="CDTX"><text:s text:c="4"/># -- all .rb files in that directory are automatically loaded.</text:p><text:p text:style-name="HE">Load Path</text:p><text:p text:style-name="FT">By default, Rails looks for code in a number of standard directories such as app/models and app/controllers, referred to collectively as the load path. You can add other directories to the load path using the following code:</text:p><text:p text:style-name="CDT1"># Add additional load paths for your own custom dirs</text:p><text:p text:style-name="CDTX"># config.load_paths += %W( #{config.root}/extras )</text:p><text:p text:style-name="FT">Note that <text:span text:style-name="CD1">config.root</text:span> refers to the root directory of your Rails application. Therefore, if you wanted to, for instance, create a separate directory for observers instead of having them in with your models, you might do the following:</text:p><text:p text:style-name="CDT1"># Add additional load paths for your own custom dirs</text:p><text:p text:style-name="CDTX">config.load_paths += %W( #{config.root}/app/observers )</text:p><text:p text:style-name="FT">In case you didn’t know, the <text:span text:style-name="CD1">%W</text:span> functions as a whitespace-delimited array literal and is used quite often in the Rails codebase for convenience.</text:p><text:p text:style-name="HE">Plugin Load Order</text:p><text:p text:style-name="FT">Normally, Rails loads plugins alphabetically by directory name. If you are unlucky enough to run into a problem with the default order, you can use the following code to adjust ordering.</text:p><text:p text:style-name="CDT1"># Only load the plugins named here, in the order given (default is alphabetical).</text:p><text:p text:style-name="CDT"># :all can be used as a placeholder for all plugins not explicitly named</text:p><text:p text:style-name="CDTX">config.plugins = [ :exception_notification, :ssl_requirement, :all ]</text:p><text:p text:style-name="FT">Chapter 19, “Extending Rails with Plugins,” covers the subject, and a companion book to this one in the Addison-Wesley Professional Ruby Series, <text:span text:style-name="T2">Rails Plugins: Extending Rails Beyond the Core</text:span> (ISBN: 0-321-48351-0) by James Adam, is an exhaustive reference about authoring plugins.</text:p><text:p text:style-name="HE">Observers</text:p><text:p text:style-name="FT"><text:span text:style-name="CD1">ActiveRecord</text:span> observers are first-class objects in your Rails applications that perform specific tasks such as clearing caches and managing denormalized data. The examples below are just that, examples of classes that you might theoretically be writing in your application as observers. (There aren’t actually <text:span text:style-name="CD1">cacher</text:span> or <text:span text:style-name="CD1">garbage_collector</text:span> observers provided by Rails, but don’t take that to mean that Ruby doesn’t do garbage collection!)</text:p><text:p text:style-name="CDT1"># Activate observers that should always be running</text:p><text:p text:style-name="CDTX">config.active_record.observers = :cacher, :garbage_collector, :forum_observer</text:p><text:p text:style-name="FT">This book covers <text:span text:style-name="CD1">ActiveRecord</text:span> observers in-depth in Chapter 9, “Advanced <text:span text:style-name="CD1">ActiveRecord</text:span>.”</text:p><text:p text:style-name="HE">Time Zones</text:p><text:p text:style-name="FT">The default time zone for Rails 3 applications is UTC. If the business domain of your application is sensitive to knowing exactly what time zone the server is in, then you can use the following setting to override the default:</text:p><text:p text:style-name="CDT1"># Set Time.zone default to the specified zone and make Active Record auto-convert</text:p><text:p text:style-name="CDT"># Run &quot;rake -D time&quot; for a list of tasks for finding time zone names.</text:p><text:p text:style-name="CDTX">config.time_zone = &apos;Central Time (US &amp; Canada)&apos;</text:p><text:p text:style-name="HE">Localization</text:p><text:p text:style-name="FT">Rails features localization support via locale files. The default local is <text:span text:style-name="CD1">:en</text:span> and can be overriden.</text:p><text:p text:style-name="CDT1"># The default locale is :en and all translations from</text:p><text:p text:style-name="CDT"># config/locales/*.rb,yml are auto loaded.</text:p><text:p text:style-name="CDT"># config.i18n.load_path += Dir[Rails.root.join(&apos;my&apos;, &apos;locales&apos;, &apos;*.{rb,yml}&apos;)]</text:p><text:p text:style-name="CDTX"># config.i18n.default_locale = :de</text:p><text:p text:style-name="HE">Generator Default Settings</text:p><text:p text:style-name="FT">Rails generator scripts make certain assumptions about your tool</text:p></text:deletion></text:changed-region><text:changed-region text:id="ct532863456"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:52:00</dc:date></office:change-info><text:p text:style-name="FT"><text:s/></text:p></text:deletion><text:insertion><office:change-info office:chg-author="Samer" office:chg-date-time="2010-03-27T15:53:00"/></text:insertion></text:changed-region><text:changed-region text:id="ct538063456"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:52:00</dc:date></office:change-info><text:p text:style-name="FT">chain. Setting the correct values here means less parameters on the command line. For instance, at Hashrocket we use RSpec without fixtures and Haml exclusively, so our settings would look like:</text:p><text:p text:style-name="CDT1"># Configure generators values. Many other options are available,</text:p><text:p text:style-name="CDT"># be sure to check the documentation.</text:p><text:p text:style-name="CDT">config.generators do |g|</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>g.template_engine :haml</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>g.test_framework <text:s/>:rspec, :fixture =&gt; false</text:p><text:p text:style-name="CDTX">end</text:p><text:p text:style-name="HD">Initializers</text:p><text:p text:style-name="FT">Rails 2 introduced the concept of breaking out configuration settings into their own small ruby files under the <text:span text:style-name="CD1">config/initializers</text:span> directory, where they are automatically loaded at startup. You can add configuration settings for your own application by adding ruby files to the initializers directory.</text:p><text:p text:style-name="IT">The following five initializers are included by default in all Rails applications.</text:p><text:p text:style-name="HE">Backtrace Silencers</text:p><text:p text:style-name="FT">Nobody likes really long exception backtraces, except maybe Java programmers. Rails has a mechanism for reducing the size of backtraces by eliminating lines that don’t really add anything to your debugging.</text:p><text:p text:style-name="IT">The backtrace_silencers.rb initializer lets you modify the way that backtraces are shortened. I’ve found it useful to remove backtrace entries for noisy libraries, but removing all silencers is usually never needed during normal application development.</text:p><text:p text:style-name="CDT1"># You can add backtrace silencers for libraries that you&apos;re using but don&apos;t</text:p><text:p text:style-name="CDT"># wish to see in your backtraces.</text:p><text:p text:style-name="CDT"># Rails.backtrace_cleaner.add_silencer { |line| line =~ /my_noisy_library/ }</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"># You can also remove all the silencers if you&apos;re trying to debug a problem</text:p><text:p text:style-name="CDT"># that might stem from framework code.</text:p><text:p text:style-name="CDTX"># Rails.backtrace_cleaner.remove_silencers!</text:p><text:p text:style-name="HE"/></text:deletion></text:changed-region><text:changed-region text:id="ct565961344"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:51:00</dc:date></office:change-info><text:p text:style-name="HE">Cookie Verification Secret</text:p><text:p text:style-name="FT">Certain types of hacking involve modifying the contents of cookies without the server knowing about it. By digitally signing all cookies sent to the browser, Rails can detect whether they were tampered with. The <text:span text:style-name="CD1">cookie_verification_secret.rb</text:span> initializer contains the secret key, randomly generated along with your app, which is used to sign cookies.</text:p><text:p text:style-name="CDT1"># Your secret key for verifying the integrity of signed cookies.</text:p><text:p text:style-name="CDT"># If you change this key, all old signed cookies will become invalid!</text:p><text:p text:style-name="CDT"># Make sure the secret is at least 30 characters and all random, </text:p><text:p text:style-name="CDT"># no regular words or you&apos;ll be exposed to dictionary attacks.</text:p><text:p text:style-name="CDTX">ActionController::Base.cookie_verifier_secret = &apos;3419dbd82eefe65c27e71b0...&apos;</text:p><text:p text:style-name="CDT"/><text:p text:style-name="HE">Inflections</text:p><text:p text:style-name="FT">Rails has a class named <text:span text:style-name="C1">Inflector</text:span> whose responsibility is to transform strings (words) from singular to plural, class names to table names, modularized class names to ones without, and class names to foreign keys, etc. (Some of its operations have funny names, such as <text:span text:style-name="C1">dasherize</text:span>.)</text:p><text:p text:style-name="IT">The default inflections for pluralization and singularization of uncountable words are kept in an interesting file inside the ActiveSupport gem, named <text:span text:style-name="CD1">inflections.rb</text:span>.</text:p><text:p text:style-name="IT">Most of the time the <text:span text:style-name="C1">Inflector</text:span> class does a decent job of figuring out the pluralized table name for a given class, but occasionally it won’t. This is one of the first stumbling blocks for many new Rails users, but it is not necessary to panic. With a little ad-hoc testing beforehand, it’s easy to find out how <text:span text:style-name="C1">Inflector</text:span> will react to certain words. We just need to use the Rails console, which by the way is one of the <text:span text:style-name="T2">best</text:span> things about working in Rails.</text:p><text:p text:style-name="IT">You fire up the console from your command prompt using the executable Ruby script located at </text:p></text:deletion></text:changed-region><text:changed-region text:id="ct533049792"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:51:00</dc:date></office:change-info><text:p text:style-name="IT"><text:span text:style-name="CD1">script/</text:span></text:p></text:deletion></text:changed-region><text:changed-region text:id="ct535359344"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:51:00</dc:date></office:change-info><text:p text:style-name="IT"><text:span text:style-name="CD1">rails </text:span></text:p></text:deletion><text:insertion><office:change-info office:chg-author="Samer" office:chg-date-time="2010-03-27T15:51:00"/></text:insertion></text:changed-region><text:changed-region text:id="ct625003648"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:51:00</dc:date></office:change-info><text:p text:style-name="IT"><text:span text:style-name="CD1">console</text:span> in your project directory.</text:p><text:p text:style-name="CDT1">$ </text:p></text:deletion></text:changed-region><text:changed-region text:id="ct533051504"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:51:00</dc:date></office:change-info><text:p text:style-name="CDT1">script/</text:p></text:deletion></text:changed-region><text:changed-region text:id="ct533623456"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:51:00</dc:date></office:change-info><text:p text:style-name="CDT1">rails </text:p></text:deletion><text:insertion><office:change-info office:chg-author="Samer" office:chg-date-time="2010-03-27T15:51:00"/></text:insertion></text:changed-region><text:changed-region text:id="ct565962976"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:51:00</dc:date></office:change-info><text:p text:style-name="CDT1">console</text:p><text:p text:style-name="CDT">&gt;&gt; Inflector.pluralize &quot;project&quot;</text:p><text:p text:style-name="CDT">=&gt; &quot;projects&quot;</text:p><text:p text:style-name="CDT">&gt;&gt; Inflector.pluralize &quot;virus&quot;</text:p><text:p text:style-name="CDT">=&gt; &quot;viri&quot;</text:p><text:p text:style-name="CDT">&gt;&gt; &quot;pensum&quot;.pluralize <text:s/># Inflector features are mixed into String by default</text:p><text:p text:style-name="CDTX">=&gt; &quot;pensums&quot;</text:p><text:p text:style-name="IT">As you can see in the example, <text:span text:style-name="C1">Inflector</text:span> is pretty smart, pluralizing “virus” as “viri”; but if you know your Latin you have already noticed that the plural “pensum” should actually be “pensa”. Needless to say, the inflector does <text:span text:style-name="T2">not</text:span> know Latin.</text:p><text:p text:style-name="IT">However, you <text:span text:style-name="T2">can</text:span> teach the inflector new tricks either by adding new pattern rules, by pointing out an exception, or by declaring certain words un-pluralizable. The preferred place to do that is inside the <text:span text:style-name="CD1">config/initializers/inflections.rb</text:span> file, where a commented example is already provided:</text:p><text:p text:style-name="CDT1">ActiveSupport::Inflector.inflections do |inflect|</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>inflect.plural /^(ox)$/i, &apos;\1en&apos;</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>inflect.singular /^(ox)en/i, &apos;\1&apos;</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>inflect.irregular &apos;person&apos;, &apos;people&apos;</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>inflect.uncountable %w( fish sheep )</text:p><text:p text:style-name="CDTX">end</text:p><text:p text:style-name="IT">For a long list of pluralizations correctly handled by <text:span text:style-name="C1">Inflector</text:span>, look for the file <text:span text:style-name="CD1">activesupport/test/inflector_test.rb</text:span>. I found some of them pretty interesting, such as:</text:p><text:p text:style-name="CDT1">&quot;datum&quot; <text:s text:c="6"/>=&gt; &quot;data&quot;,</text:p><text:p text:style-name="CDT">&quot;medium&quot; <text:s text:c="5"/>=&gt; &quot;media&quot;,</text:p><text:p text:style-name="CDTX">&quot;analysis&quot; <text:s text:c="3"/>=&gt; &quot;analyses&quot;</text:p><text:p text:style-name="HE">Custom MIME Types</text:p><text:p text:style-name="FT">Rails supports a standard set of MIME types (*/*, text/html, text/plain, text/javascript, text/css, text/calendar, text/csv, application/xml, application/rss+xml, application/atom+xml, application/x-yaml, multipart/form-data, application/x-www-form-urlencoded) <office:annotation><dc:creator>Obie Fernandez</dc:creator><dc:date>2010-01-05T21:54:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">Someone please turn this into a table with the short names, respond_to symbols and optional aliases, maybe even a short explanation of what they’re used for. Refer to actionpack/lib/action_dispatch/http/mime_types.rb for more information.</text:span></text:p></office:annotation></text:p><text:p text:style-name="TH"><text:span text:style-name="TN"/></text:p></text:deletion></text:changed-region><text:changed-region text:id="ct45363616"><text:deletion><office:change-info><dc:creator>Samer</dc:creator><dc:date>2010-03-27T15:37:00</dc:date></office:change-info><text:p text:style-name="TH"><text:span text:style-name="TN">Table 1.1</text:span>   Rails standard MIME types</text:p></text:deletion></text:changed-region><text:changed-region text:id="ct624991440"><text:deletion><office:change-info><dc:creator>Eliza Brock</dc:creator><dc:date>2010-11-29T09:51:00</dc:date></office:change-info><text:p text:style-name="TH"><text:span text:style-name="CD1"/></text:p><text:p text:style-name="P1">Table 1.1 <text:s text:c="2"/>Rails standard MIME types</text:p><text:p text:style-name="P1">Short name<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>respond_to symbol<text:tab/><text:tab/><text:tab/>Aliases</text:p><text:p text:style-name="P1">text/html<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:html, : xhtml<text:tab/><text:tab/><text:tab/><text:tab/>application/xhtml+xml</text:p><text:p text:style-name="P1">text/plain<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:text, :txt<text:tab/><text:tab/></text:p><text:p text:style-name="P1">text/javascript<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:js<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>application/javascript</text:p><text:p text:style-name="P1"><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>application/x-javascript<text:tab/><text:tab/><text:tab/></text:p><text:p text:style-name="P1">text/css<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:css<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>Cascading style sheets</text:p><text:p text:style-name="P1">text/calendar<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:ics<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>iCalendar format for sharing meeting requests and tasks</text:p><text:p text:style-name="P1">text/csv<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:csv<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>Comma-separated values<text:tab/></text:p><text:p text:style-name="P1">application/xml<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:xml<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>text/xml</text:p><text:p text:style-name="P1"><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>application/x-xml<text:tab/></text:p><text:p text:style-name="P1">application/rss+xml<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:rss<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>Really Simple Syndication format for web feeds</text:p><text:p text:style-name="P1">application/atom+xml<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:atom<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>Atom Syndication Format for web feeds</text:p><text:p text:style-name="P1">application/x-yaml<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:yaml<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>text/yaml<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>The human-readable data serialization format</text:p><text:p text:style-name="P1">application/x-www-form-urlencoded<text:tab/><text:tab/>:url_encoded_form<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>Default content type of HTML forms</text:p><text:p text:style-name="P1">multipart/form-data<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:multipart_form<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>Used for HTML forms that contain files, non-ASCII data, and binary data</text:p><text:p text:style-name="P1">application/json<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:json<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>text/x-json<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>JavaScript Object Notation</text:p><text:p text:style-name="P1"><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>application/jsonrequest</text:p><text:p text:style-name="P1">*/*<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>:all<text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/><text:tab/>Used to respond to any request for a format that is not handled</text:p><text:p text:style-name="P2"/><text:p text:style-name="IT"/><text:p text:style-name="IT">If your application needs to respond to other MIME types, you can register them in the <text:span text:style-name="CD1">mime_types.rb</text:span> initializer</text:p><text:p text:style-name="CDT1"># Add new mime types for use in respond_to blocks:</text:p><text:p text:style-name="CDT"># Mime::Type.register &quot;text/richtext&quot;, :rtf</text:p><text:p text:style-name="CDTX"># Mime::Type.register_alias &quot;text/html&quot;, :iphone</text:p><text:p text:style-name="HE">Session Store</text:p><text:p text:style-name="FT">Session cookies in Rails are signed <office:annotation><dc:creator>Obie Fernandez</dc:creator><dc:date>2010-01-05T22:01:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">wording might need to be a little more accurate</text:span></text:p></office:annotation>with a random secret string that’s generated along with new Rails apps. You can change that secret string if you’re really paranoid.</text:p><text:p text:style-name="CDT1"># Your secret key for verifying cookie session data integrity.</text:p><text:p text:style-name="CDT"># If you change this key, all old sessions will become invalid!</text:p><text:p text:style-name="CDT"># Make sure the secret is at least 30 characters and all random, </text:p><text:p text:style-name="CDT"># no regular words or you&apos;ll be exposed to dictionary attacks.</text:p><text:p text:style-name="CDT">ActionController::Base.session = {</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>:key <text:s text:c="8"/>=&gt; &apos;_rocketeers_session&apos;,</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>:secret <text:s text:c="5"/>=&gt; &apos;70c647f83a15edd9895b86c16...&apos;</text:p><text:p text:style-name="CDTX">}</text:p><text:p text:style-name="FT">If you want to store user sessions in the database instead of in cookies, which you might want to do if your application keeps sensitive data in sessions, then this initializer is the place to do it:</text:p><text:p text:style-name="CDT1"># Use the database for sessions instead of the cookie-based default</text:p><text:p text:style-name="CDT"># (create the session table with &quot;rake db:sessions:create&quot;)</text:p><text:p text:style-name="CDTX">ActionController::Base.session_store = :active_record_store</text:p><text:p text:style-name="FT">This book covers configuration and implications of <text:span text:style-name="CD1">ActiveRecord</text:span> session store in Chapter 13, “Session Management.”</text:p><text:p text:style-name="HD">Additional Configuration</text:p><text:p text:style-name="FT">That does it for the configuration options for which we get examples in the default <text:span text:style-name="CD1">application.rb</text:span> and the standard initializers. There are additional options, which you can add in additional initializer files.</text:p><text:p text:style-name="HE">Log-Level Override</text:p><text:p text:style-name="FT">The default log level is <text:span text:style-name="CD1">:debug</text:span> and you can override it if necessary.</text:p><text:p text:style-name="CDT1"><text:s text:c="2"/># Force all environments to use the same logger level</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># (by default production uses :info, the others :debug)</text:p><text:p text:style-name="CDTX"><text:s text:c="2"/>config.log_level = :debug</text:p><text:p text:style-name="FT">This book covers use of the Rails logger in-depth later on in this chapter.</text:p><text:p text:style-name="HE">Schema Dumper</text:p><text:p text:style-name="FT">Every time you run tests, Rails dumps the schema of your development database and copies it to the test database using an autogenerated <text:span text:style-name="CD1">schema.rb</text:span> script. It looks very similar to an <text:span text:style-name="CD1">ActiveRecord</text:span> migration script; in fact, it uses the same API.</text:p><text:p text:style-name="IT">You might find it necessary to revert to the older style of dumping the schema using SQL, if you’re doing things that are incompatible with the schema dumper code (see the comment).</text:p><text:p text:style-name="CDT1"><text:s text:c="2"/># Use SQL instead of Active Record&apos;s schema dumper when creating the</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># test database. This is necessary if your schema can&apos;t be completely</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># dumped by the schema dumper, for example, if you have constraints</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># or db-specific column types</text:p><text:p text:style-name="CDTX"><text:s text:c="2"/>config.active_record.schema_format = :sql</text:p><text:p text:style-name="FT"/><text:p text:style-name="FT">Remember we said that the value of the <text:span text:style-name="CD1">RAILS_ENV</text:span> environment variable dictates which additional environment settings are loaded next? So now let’s review the default settings for each of Rails’ standard modes.</text:p><text:p text:style-name="HC">Development Mode</text:p><text:p text:style-name="FT">Development is Rails’ default mode and the one in which you will spend most of your time as a developer. This section contains an in-depth explanation of each setting.</text:p><text:p text:style-name="CDT1"># File: config/environments/development.rb</text:p><text:p text:style-name="CDT">Rocketeer::Application.configure do</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># Settings specified here will take precedence over those</text:p><text:p text:style-name="CDTX"><text:s text:c="2"/># in config/environment.rb</text:p><text:p text:style-name="HD">Automatic Class Reloading</text:p><text:p text:style-name="FT">One of the signature benefits of using Rails is the quick feedback cycle whenever you’re working in development mode. Make changes to your code, hit Reload in the browser, and <text:span text:style-name="T2">Shazam!</text:span> Magically, the changes are reflected in your application. This behavior is governed by the <text:span text:style-name="CD1">config.cache_classes</text:span> setting:</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"># In the development environment your application&apos;s code is reloaded on</text:p><text:p text:style-name="CDT"># every request. <text:s/>This slows down response time but is perfect for development</text:p><text:p text:style-name="CDT"># since you don&apos;t have to restart the webserver when you make code changes.</text:p><text:p text:style-name="CDT">config.cache_classes = false</text:p><text:p text:style-name="CDT"/><text:p text:style-name="FT">Without getting into too much nitty-gritty detail, when the <text:span text:style-name="CD1">config.cache_<text:line-break/>classes</text:span> setting is <text:span text:style-name="CD1">true</text:span>, Rails will use Ruby’s <text:span text:style-name="CD1">require</text:span> statement to do its class loading, and when it is <text:span text:style-name="CD1">false</text:span>, it will use <text:span text:style-name="CD1">load</text:span> instead.</text:p><text:p text:style-name="IT">When you require a Ruby file, the interpreter executes and caches it. If the file is required again (as in subsequent requests), the interpreter ignores the request statement and moves on. When you load a Ruby file, the interpreter executes the file again, no matter how many times it has been loaded before.</text:p><text:p text:style-name="IT">Now it’s time to examine the Rails class-loading behavior a bit more in depth, because sometimes you won’t be able to get certain things to reload automatically and it will drive you crazy <text:span text:style-name="T2">unless</text:span> you understand how class loading works!</text:p><text:p text:style-name="HE">The Rails Class Loader</text:p><text:p text:style-name="FT">In plain old Ruby, a script file doesn’t need to be named in any particular way that matches its contents. In Rails, however, you’ll notice that there’s almost always a direct correlation between the name of a Ruby file and the class contained within. Rails takes advantage of the fact that Ruby provides a callback mechanism for missing constants. When Rails encounters an undefined constant in the code, it uses a classloader routine based on file-naming conventions to find and require the needed Ruby script.</text:p><text:p text:style-name="IT">How does the classloader know where to search? We already covered it earlier in the chapter where we discussed the role of <text:span text:style-name="CD1">initializer.rb</text:span> in the Rails startup process. Rails has the concept of load paths, and the default load paths include the base directories of just about anywhere you would think of adding code to your Rails application.</text:p><text:p text:style-name="IT">The <text:span text:style-name="CD1">default_load_paths</text:span> method shows you the order in which Rails searches the directories in its load path. We’ll dissect the source of this method here and explain the reason behind each part of the load path.</text:p><text:p text:style-name="IT">The <text:span text:style-name="CD1">test/mocks</text:span> directory (covered more extensively in Chapter 17, “Testing,”) is provided to give you the ability to override the behavior of standard Rails classes.</text:p><text:p text:style-name="CDT1">paths = [&quot;#{root_path}/test/mocks/#{environment}&quot;]</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"># Add the app&apos;s controller directory</text:p><text:p text:style-name="CDT">paths.concat(Dir[&quot;#{root_path}/app/controllers/&quot;])</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"># Then components subdirectories.</text:p><text:p text:style-name="CDT">paths.concat(Dir[&quot;#{root_path}/components/[_a-z]*&quot;])</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"># Followed by the standard includes.</text:p><text:p text:style-name="CDT">paths.concat %w(</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>app</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>app/models</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>app/controllers</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>app/helpers</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>app/services</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>app/apis</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>components</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>lib</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>vendor</text:p><text:p text:style-name="CDT">).map { |dir| &quot;#{root_path}/#{dir}&quot; }.select { |dir|</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>File.directory?(dir) }</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/>paths.concat Dir[&quot;#{root_path}/vendor/plugins/*/lib/&quot;]</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>paths.concat builtin_directories</text:p><text:p text:style-name="CDTX">end</text:p><text:p text:style-name="FT">Want to see the contents of your project’s load path? Just fire up the console and type <text:span text:style-name="CD1"><text:span text:style-name="T3">$LOAD_PATH</text:span></text:span><text:span text:style-name="CD1"><text:span text:style-name="T4"> </text:span></text:span>as follows:</text:p><text:p text:style-name="CDT1">$ console</text:p><text:p text:style-name="CDT">Loading development environment.</text:p><text:p text:style-name="CDT">&gt;&gt; $LOAD_PATH</text:p><text:p text:style-name="CDTX">=&gt; [&quot;/usr/local/lib/ruby/... # about 20 lines of output</text:p><text:p text:style-name="FT">I snipped the console output to save space. A typical Rails project load path will usually have 30 or more items in its load path. Try it and see. </text:p><text:p text:style-name="HE">Rails, Modules, and Auto-Loading Code</text:p><text:p text:style-name="FT">Normally in Ruby, when you want to include code from another file in your application, you have to include a require statement. However, Rails enhances Ruby’s default behavior by establishing a simple convention that enables Rails to automatically load your code in most cases.</text:p><text:p text:style-name="IT">If you’ve used the Rails console at all, you’ve already seen this behavior in action: You never have to explicitly load anything!</text:p><text:p text:style-name="IT">This is how it works: If Rails encounters a class or module in your code that is not already defined, Rails uses the following convention to guess which files it should require to load that module or class:</text:p><text:p text:style-name="IT">If the class or module is not nested, insert an underscore between the constant’s names and require a file of this name. For example:</text:p><text:p text:style-name="BL"><text:tab/><text:tab/><text:tab/>•<text:tab/>EstimationCalculator becomes require ‘estimation_calculator’</text:p><text:p text:style-name="BL"><text:tab/><text:tab/><text:tab/>•<text:tab/>KittTurboBoost becomes require ‘kitt_turbo_boost</text:p><text:p text:style-name="FT">If the class or module is nested, Rails inserts an underscore between each of the containing modules and requires a file in the corresponding set of subdirectories. For example:</text:p><text:p text:style-name="BL"><text:span text:style-name="T5"><text:tab/></text:span><text:tab/><text:tab/>•<text:tab/>MacGyver::SwissArmyKnife becomes require ‘mac_gyver/swiss_army_knife’</text:p><text:p text:style-name="P3"><text:tab/>•<text:tab/><text:span text:style-name="CD1">Some::ReallyRatherDeeply::NestedClass</text:span> becomes <text:span text:style-name="CD1">require &apos;some/<text:line-break/>really_rather_deeply/nested_class&apos;</text:span> and if not already loaded, Rails would expect to find it in a file called <text:span text:style-name="CD1">nested_class.rb</text:span>, in a directory called <text:span text:style-name="CD1">really_rather_deeply</text:span>, itself in the directory <text:span text:style-name="CD1">some</text:span> of which can be found somewhere in Ruby’s load path (e.g., one of the <text:span text:style-name="CD1">app</text:span> subdirectories, <text:span text:style-name="CD1">lib</text:span>, or a plugin’s <text:span text:style-name="CD1">lib</text:span> directory).</text:p><text:p text:style-name="FT">The bottom line is that you should rarely need to explicitly load Ruby code in your Rails applications (using <text:span text:style-name="CD1">require</text:span>) if you follow the naming conventions.</text:p><text:p text:style-name="HD">Whiny Nils</text:p><text:p text:style-name="CDT"># Log error messages when you accidentally call methods on nil.</text:p><text:p text:style-name="CDT">config.whiny_nils = true</text:p><text:p text:style-name="HD">Error Reports</text:p><text:p text:style-name="CDT">config.action_controller.consider_all_requests_local = true</text:p><text:p text:style-name="CDT">config.action_view.debug_rjs <text:s text:c="24"/>= true</text:p><text:p text:style-name="HD">Caching</text:p><text:p text:style-name="CDT">config.action_controller.perform_caching <text:s text:c="12"/>= false</text:p><text:p text:style-name="HD">Raise Delivery Errors</text:p><text:p text:style-name="CDT"># Don&apos;t care if the mailer can&apos;t send</text:p><text:p text:style-name="CDT">config.action_mailer.raise_delivery_errors = false</text:p><text:p text:style-name="HC"><office:annotation><dc:creator>Obie Fernandez</dc:creator><dc:date>2010-01-05T22:56:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">Needs commentary</text:span></text:p></office:annotation>Test Mode</text:p><text:p text:style-name="FT">Whenever you run Rails in test mode, that is, the value of the <text:span text:style-name="CD1">RAILS_ENV</text:span> environment value is <text:span text:style-name="CD1">test</text:span>, then the following settings are in effect:</text:p><text:p text:style-name="CDT1"># File: config/environments/test.rb</text:p><text:p text:style-name="CDT">Rocketeer::Application.configure do</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># The test environment is used exclusively to run your application&apos;s</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># test suite. <text:s/>You never need to work with it otherwise. <text:s/>Remember that</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># your test database is &quot;scratch space&quot; for the test suite and is wiped</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># and recreated between test runs. <text:s/>Don&apos;t rely on the data there!</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.cache_classes = true</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Log error messages when you accidentally call methods on nil.</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.whiny_nils = true</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Show full error reports and disable caching</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.action_controller.consider_all_requests_local = true</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.action_controller.perform_caching <text:s text:c="12"/>= false</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Disable request forgery protection in test environment</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.action_controller.allow_forgery_protection <text:s text:c="3"/>= false</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># The :test delivery method accumulates sent emails in the</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># ActionMailer::Base.deliveries array.</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.action_mailer.delivery_method = :test</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDTX">end</text:p><text:p text:style-name="FT">Most people get by without ever needing to modify their test environment settings.</text:p><text:p text:style-name="HC">Production Mode</text:p><text:p text:style-name="FT">Finally, production mode is what you want your Rails application running in whenever it is deployed to its hosting environment and serving public requests. There are a number of significant ways that production mode differs from the other modes, not least of which is the speed boost you get from not reloading all of your application classes for every request.</text:p><text:p text:style-name="CDT1"># File: config/environments/production.rb</text:p><text:p text:style-name="CDT">Rocketeer::Application.configure do</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># The production environment is meant for finished, &quot;live&quot; apps.</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># Code is not reloaded between requests</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.cache_classes = true</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Full error reports are disabled and caching is turned on</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.action_controller.consider_all_requests_local = false</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.action_controller.perform_caching <text:s text:c="12"/>= true</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># See everything in the log (default is :info)</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># config.log_level = :debug</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Use a different logger for distributed setups</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># config.logger = SyslogLogger.new</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Use a different cache store in production</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># config.cache_store = :mem_cache_store</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Disable Rails&apos;s static asset server</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># In production, Apache or nginx will already do this</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>config.serve_static_assets = false</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Enable serving of images, stylesheets, and javascripts from an asset server</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># config.action_controller.asset_host = &quot;http://assets.example.com&quot;</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Disable delivery errors, bad email addresses will be ignored</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># config.action_mailer.raise_delivery_errors = false</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/># Enable threaded mode</text:p><text:p text:style-name="CDT"><text:s text:c="2"/># config.threadsafe!</text:p><text:p text:style-name="CDTX">end</text:p><text:p text:style-name="TIH">Custom Environments</text:p><text:p text:style-name="TI">If necessary, you can create additional environments for your Rails app to run by cloning one of the existing environment files in the <text:span text:style-name="C1">config/environments</text:span> directory of your application. The most common use case for custom environments is in setting up additional production configurations, such as for staging and QA deployments.</text:p><text:p text:style-name="TI">Do you have access to the production database from your development workstation? Then a <text:span text:style-name="T2">triage</text:span> environment might make sense. Use the normal environment settings for development mode, but point its database connection to a production database server. It’s a potentially life-saving combination when you need to quickly diagnose issues in production.</text:p><text:p text:style-name="HC">Logging</text:p><text:p text:style-name="FT">Most programming contexts in Rails (models, controllers, view templates) have a <text:span text:style-name="CD1">logger</text:span> attribute, which holds a reference to a logger conforming to the interface of <text:span text:style-name="CD1">Log4r</text:span> or the default Ruby 1.8+ <text:span text:style-name="CD1">Logger</text:span> class. Can’t get a reference to <text:span text:style-name="CD1">logger</text:span> somewhere in your code? The <text:span text:style-name="CD1">Rails.logger</text:span> method references to the logger <office:annotation><dc:creator>Eliza Brock</dc:creator><dc:date>2010-04-18T21:01:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">This doesn’t seem grammatically correct.</text:span></text:p></office:annotation>that you can use anywhere.</text:p><text:p text:style-name="IT">It’s really easy to create a new <text:span text:style-name="CD1">Logger</text:span> in Ruby, as shown in the following example:</text:p><text:p text:style-name="CDT1">$ irb</text:p><text:p text:style-name="CDT">&gt; require &apos;logger&apos;</text:p><text:p text:style-name="CDT">=&gt; true</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT">irb(main):002:0&gt; logger = Logger.new STDOUT</text:p><text:p text:style-name="CDT">=&gt; #&lt;Logger:0x32db4c @level=0, @progname=nil, @logdev=</text:p><text:p text:style-name="CDT">#&lt;Logger::LogDevice:0x32d9bc ... &gt;</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT">&gt; logger.warn &quot;do not want!!!&quot;</text:p><text:p text:style-name="CDT">W, [2007-06-06T17:25:35.666927 #7303] <text:s/>WARN -- : do not want!!!</text:p><text:p text:style-name="CDT">=&gt; true</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT">&gt; logger.info &quot;in your logger, giving info&quot;</text:p><text:p text:style-name="CDT">I, [2007-06-06T17:25:50.787598 #7303] <text:s/>INFO -- : in your logger, giving</text:p><text:p text:style-name="CDT">your info</text:p><text:p text:style-name="CDTX">=&gt; true</text:p><text:p text:style-name="FT">Typically, you add a message to the log using the logger whenever the need arises, using a method corresponding to the severity of the log message. The standard logger’s severities are (in increasingly severe order):</text:p><text:p text:style-name="BL1"><text:tab/>•<text:tab/><text:span text:style-name="T6">debug</text:span>  Use the debug level to capture data and application state useful for debugging problems later on. This level is not usually captured in production logs.</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/><text:span text:style-name="T6">info</text:span>  Use info level to capture informational messages. I like to use this log level for time-stamping non-ordinary events that are still within the bounds of good application behavior.</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/><text:span text:style-name="T6">warn</text:span>  Use the warn level to capture things that are out of the ordinary and might be worth investigating. Sometimes I’ll throw in a logged warning when guard clauses in my code keep a client from doing something they weren’t supposed to do. My goal is to alert whoever’s maintaining the application about a malicious user or bug in the user interface, as in the following example: </text:p><text:p text:style-name="P4">def create</text:p><text:p text:style-name="P5"><text:s text:c="2"/>begin</text:p><text:p text:style-name="P5"><text:s text:c="4"/>group.add_member(current_user)</text:p><text:p text:style-name="P5"><text:s text:c="4"/>flash[:notice] = &quot;Successfully joined #{scene.display_name}&quot;</text:p><text:p text:style-name="P5"><text:s text:c="2"/>rescue ActiveRecord::RecordInvalid</text:p><text:p text:style-name="P5"><text:s text:c="4"/>flash[:error] = &quot;You are already a member of #{group.name}&quot;</text:p><text:p text:style-name="P5"><text:s text:c="4"/>logger.warn &quot;A user tried to join a group twice. UI should</text:p><text:p text:style-name="P5"><text:s text:c="17"/>not have allowed it.&quot;</text:p><text:p text:style-name="P5"><text:s text:c="2"/>end</text:p><text:p text:style-name="P5"/><text:p text:style-name="P5"><text:s text:c="2"/>redirect_to :back</text:p><text:p text:style-name="P6">end</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/><text:span text:style-name="T6">error</text:span>  Use the error log level to capture information about error conditions that don’t require a server restart.</text:p><text:p text:style-name="BX"><text:tab/>•<text:tab/><text:span text:style-name="T6">fatal</text:span>  The worst-case imaginable has happened—your application is now dead and manual intervention is necessary to restart it.</text:p><text:p text:style-name="HD">Rails Log Files</text:p><text:p text:style-name="FT">The <text:span text:style-name="CD1">log</text:span> folder of your Rails application holds three log files corresponding to each of the standard environments, plus a log and pid file for Mongrel. Log files can grow very large over time. A rake task is provided for easily clearing the log files:</text:p><text:p text:style-name="C1">rake log:clear <text:s/># Truncates all *.log files in log/ to zero bytes</text:p><text:p text:style-name="FT">The contents of <text:span text:style-name="CD1">log/development.log</text:span> are very useful while you’re working. Many Rails coders leave a terminal window open with a continuous tail of the development log open while they’re coding:</text:p><text:p text:style-name="CDT1">$ tail -f log/development.log</text:p><text:p text:style-name="CDT"/><text:p text:style-name="CDT"><text:s text:c="2"/>User Load (0.000522) <text:s text:c="2"/>SELECT * FROM users WHERE (users.&apos;id&apos; = 1)</text:p><text:p text:style-name="CDTX"><text:s text:c="2"/>CACHE (0.000000) <text:s text:c="2"/>SELECT * FROM users WHERE (users.&apos;id&apos; = 1)</text:p><text:p text:style-name="FT">All sorts of valuable information are available in the development log. For instance, every time you make a request, a bunch of useful information about it shows up in the log. Here’s a sample from one of my projects, followed by a list of all the data items it contains:</text:p><text:p text:style-name="CDT1">Processing UserPhotosController#show (for 127.0.0.1 at 2007-06-06<office:annotation><dc:creator>Nick Quaranto</dc:creator><dc:date>2010-01-25T00:42:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">Update log date</text:span></text:p></office:annotation></text:p><text:p text:style-name="CDT">17:43:13) [GET]</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>Session ID: b362cf038810bb8dec076fcdaec3c009</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>Parameters: {&quot;/users/8-Obie-Fernandez/photos/406&quot;=&gt;nil,</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>&quot;action&quot;=&gt;&quot;show&quot;, &quot;id&quot;=&gt;&quot;406&quot;, &quot;controller&quot;=&gt;&quot;user_photos&quot;,</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>&quot;user_id&quot;=&gt;&quot;8-Obie-Fernandez&quot;}</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>User Load (0.000477) <text:s text:c="2"/>SELECT * FROM users WHERE (users.&apos;id&apos; = 8)</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>Photo Columns (0.003182) <text:s text:c="2"/>SHOW FIELDS FROM photos</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>Photo Load (0.000949) <text:s text:c="2"/>SELECT * FROM photos WHERE (photos.&apos;id&apos; = 406</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>AND (photos.resource_id = 8 AND photos.resource_type = &apos;User&apos;))</text:p><text:p text:style-name="CDT">Rendering template within layouts/application</text:p><text:p text:style-name="CDT">Rendering photos/show</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>CACHE (0.000000) <text:s text:c="2"/>SELECT * FROM users WHERE (users.&apos;id&apos; = 8)</text:p><text:p text:style-name="CDT">Rendered adsense/_medium_rectangle (0.00155)</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>User Load (0.000541) <text:s text:c="2"/>SELECT * FROM users WHERE (users.&apos;id&apos; = 8)</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>LIMIT 1</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>Message Columns (0.002225) <text:s text:c="2"/>SHOW FIELDS FROM messages</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>SQL (0.000439) <text:s text:c="2"/>SELECT count(*) AS count_all FROM messages WHERE</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>(messages.receiver_id = 8 AND (messages.&apos;read&apos; = 0))</text:p><text:p text:style-name="CDT">Rendered layouts/_header (0.02535)</text:p><text:p text:style-name="CDT">Rendered adsense/_leaderboard (0.00043)</text:p><text:p text:style-name="CDT">Rendered layouts/_footer (0.00085)</text:p><text:p text:style-name="CDT">Completed in 0.09895 (10 reqs/sec) | Rendering: 0.03740 (37%) | DB:</text:p><text:p text:style-name="CDT">0.01233 (12%) | 200 OK [http://localhost/users/8-Obie-</text:p><text:p text:style-name="CDT">Fernandez/photos/406]</text:p><text:p text:style-name="CDTX"><text:s text:c="2"/>User Columns (0.004578) <text:s text:c="2"/>SHOW FIELDS FROM users<office:annotation><dc:creator>Obie Fernandez</dc:creator><dc:date>2010-01-26T17:51:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">The whole thing needs updating because the logger output changed somewhat.</text:span></text:p></office:annotation></text:p><text:p text:style-name="BL1"><text:tab/>•<text:tab/>The controller and action that were invoked</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>The remote IP address of the computer making the request</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>A timestamp indicating when the request happened</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>The session ID associated with the request</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>The hash of parameters associated with the request</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>Database request information including the time and the SQL statement <text:line-break/>executed</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>Query cache hit info including time and the SQL statement triggering results from the cache instead of a roundtrip to the database</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>Rendering information for each template involved in rendering the view output and time consumed by each</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>Total time used in completing the request with corresponding request-per-second figures</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>Analysis of the time spent in database operations versus rendering</text:p><text:p text:style-name="BX"><text:tab/>•<text:tab/>The HTTP status code and URL of the response sent back to the client</text:p><text:p text:style-name="HD">Log File Analysis</text:p><text:p text:style-name="FT">A number of informal analyses can be easily performed using just the development log output and some common sense.</text:p><text:p text:style-name="BL1"><text:tab/>•<text:tab/><text:span text:style-name="T6">Performance</text:span>  One of the more obvious analyses would be a study of the performance of your application. The faster your requests execute, the more requests you can serve with a given Rails process. That’s why performance figures are often expressed in terms of <text:span text:style-name="T2">requests per second</text:span>. Find the queries and rendering sections that are taking a long time and figure out why.</text:p><text:p text:style-name="BL"><text:tab/><text:tab/>It’s important to realize that the times reported by the logger are <text:span text:style-name="T2">not super-<text:line-break/>accurate</text:span>. In fact, they’re wrong more often than not, if simply for the reason that it’s very difficult to measure the timing of something from within itself. Add up the percentage of rendering and database times for any given request and it will not always be close to 100%.</text:p><text:p text:style-name="BL"><text:tab/><text:tab/>However, despite not being accurate in a purely objective sense, the reported times are perfect for making subjective comparisons within the same application. They give you a way of gauging whether an action is taking longer than it used to, or whether it is relatively faster or slower than another action, and so on.</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/><text:span text:style-name="T6">SQL queries</text:span>  <text:span text:style-name="CD1">ActiveRecord</text:span> not behaving as expected? The fact that SQL generated by <text:span text:style-name="CD1">ActiveRecord</text:span> is logged can often help you debug problems caused by complicated queries.</text:p><text:p text:style-name="BX"><text:tab/>•<text:tab/><text:span text:style-name="T6">Identification of N+1 select problems</text:span>  Whenever you are displaying a record along with an associated collection of records, there’s a chance that you will have a so-called <text:span text:style-name="T2">N+1 select</text:span> problem. You’ll recognize the problem by a series of many <text:span text:style-name="CD1">SELECT</text:span> statements, with the only difference being the value of the primary key.</text:p><text:p text:style-name="FT">For example, here’s a snippet of some log output from a real Rails application showing an N+1 select issue in the way that <text:span text:style-name="CD1">FlickrPhoto</text:span> instances are being loaded:</text:p><text:p text:style-name="CDT1"><text:s text:c="2"/>FlickrPhoto Load (0.001395) <text:s text:c="2"/>SELECT * FROM flickr_photos WHERE</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>(flickr_photos.resource_id = 15749 AND flickr_photos.resource_type =</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>&apos;Place&apos; AND (flickr_photos.&apos;profile&apos; = 1)) ORDER BY updated_at desc</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>LIMIT 1</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>FlickrPhoto Load (0.001734) <text:s text:c="2"/>SELECT * FROM flickr_photos WHERE</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>(flickr_photos.resource_id = 15785 AND flickr_photos.resource_type =</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>&apos;Place&apos; AND (flickr_photos.&apos;profile&apos; = 1)) ORDER BY updated_at desc</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>LIMIT 1</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>FlickrPhoto Load (0.001440) <text:s text:c="2"/>SELECT * FROM flickr_photos WHERE</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>(flickr_photos.resource_id = 15831 AND flickr_photos.resource_type =</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>&apos;Place&apos; AND (flickr_photos.&apos;profile&apos; = 1)) ORDER BY updated_at desc</text:p><text:p text:style-name="CDTX"><text:s text:c="2"/>LIMIT 1</text:p><text:p text:style-name="FT"><office:annotation><dc:creator>Obie Fernandez</dc:creator><dc:date>2010-01-26T17:52:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">Update to newest logfile output.</text:span></text:p></office:annotation>… and so on and so forth, for pages and pages of log output. Look familiar?</text:p><text:p text:style-name="IT">Luckily, each of those database queries is executing very quickly, around 0.0015 seconds each. That’s because 1) MySQL is extraordinarily fast for small <text:span text:style-name="CD1">SELECT</text:span> statements and 2) my Rails process is on the same physical machine as the database.</text:p><text:p text:style-name="IT">Still, accumulate enough of those N queries and they add up quickly to eat away at performance. Absent the mitigating factors I mentioned, I would have a serious performance problem to address. The problem would be especially severe if the database was on a separate machine, giving me network latency to deal with on each of those queries.</text:p><text:p text:style-name="IT">N+1 select issues are not the end of the world. A lot of times all it takes is proper use of an <text:span text:style-name="CD1">:include</text:span> option on a particular <text:span text:style-name="CD1">find</text:span> method call to alleviate the <text:line-break/>problem. </text:p><text:p text:style-name="BX"><text:tab/>•<text:tab/><text:span text:style-name="T6">Separation of concerns</text:span>  A well-designed model-view-controller application follows certain protocols related to which logical tier does database operations (that would be the model) versus rendering tasks (the view). Generally speaking, you want your controller to cause the loading of all of the data that is going to be needed for rendering from the database. In Rails, it is accomplished by controller code that queries the model for needed data and stores that data in instance variables to be consumed by the view.</text:p><text:p text:style-name="IT">Database access during rendering is usually considered a bad practice. Calling <text:span text:style-name="CD1">find</text:span> methods directly from template code violates proper separation of concerns and is a maintainability nightmare.<text:span text:style-name="T7">4</text:span></text:p><text:p text:style-name="IT">However, there are plenty of opportunities for implicit database access during view rendering to creep into your codebase, encapsulated by the model, and perhaps triggered by lazy loading of associations. Can we conclusively call it a bad practice? It’s hard to say so definitively. There are cases (such as usage of fragment caching) where it makes sense to have database operations happening during view rendering.</text:p><text:p text:style-name="TIH">Using Alternate Logging Schemes</text:p><text:p text:style-name="TI">It’s easy! Just assign a class compatible with Ruby’s Logger to one of the various <text:span text:style-name="C1">logger</text:span> class variables, such as <text:span text:style-name="C1">ActiveRecord::Base.logger</text:span>.</text:p><text:p text:style-name="TI">A quick hack based on the ability to swap loggers is one demonstrated by David at various events, including his keynote at Railsconf 2007. During a console session, assign a new <text:span text:style-name="C1">Logger</text:span> instance pointing to <text:span text:style-name="C1">STDOUT</text:span> to <text:span text:style-name="C1">ActiveRecord::Base.logger</text:span> in order to see the SQL being generated right in your console. Jamis has a complete write-up of the technique and more at http://<text:line-break/>weblog.jamisbuck.org/2007/1/31/more-on-watching-activerecord.</text:p><text:p text:style-name="HE"><text:span text:style-name="C1">Rails::Subscriber.colorize_logging</text:span><office:annotation><dc:creator>Obie Fernandez</dc:creator><dc:date>2010-01-21T23:49:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">Does this belong here?</text:span></text:p><text:p text:style-name="P20"><text:span text:style-name="T14"/></text:p></office:annotation></text:p><text:p text:style-name="FT">Tells Rails whether or not to use ANSI codes to colorize the logging statements. The colors make it much easier to read the logs (except on Windows) and may complicate matters if you use software like syslog. Defaults to <text:span text:style-name="C1">true</text:span>. Change to <text:span text:style-name="C1">false</text:span> if you view your logs with software that doesn’t understand the ANSI color codes.</text:p><text:p text:style-name="IT">Here’s a snippet of log output with the ANSI codes visible:</text:p><text:p text:style-name="CDT1">^[[4;36;1mSQL (0.000000)^[[0m <text:s text:c="2"/>^[[0;1mMysql::Error: Unknown table</text:p><text:p text:style-name="CDT">&apos;expense_reports&apos;: DROP TABLE expense_reports^[[0m</text:p><text:p text:style-name="CDT"><text:s text:c="2"/>^[[4;35;1mSQL (0.003266)^[[0m <text:s text:c="2"/>^[[0mCREATE TABLE expense_reports (&apos;id&apos;</text:p><text:p text:style-name="CDT">int(11) DEFAULT NULL auto_increment PRIMARY KEY, &apos;user_id&apos; int(11)) </text:p><text:p text:style-name="CDT"/><text:p text:style-name="TIH">Wilson Says…</text:p><text:p text:style-name="P7">Almost nobody I meet seems to know how to display colorized logs in a pager. The <text:span text:style-name="C1">-R</text:span> option tells <text:span text:style-name="C1">less</text:span> to output “raw” control characters to the screen.</text:p><text:p text:style-name="HD"><office:annotation><dc:creator>Obie Fernandez</dc:creator><dc:date>2010-01-21T23:50:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">Matches Rails 3?</text:span></text:p></office:annotation>Syslog</text:p><text:p text:style-name="FT">UNIX-like systems have a system service called <text:span text:style-name="CD1">syslog</text:span>. For various reasons, it might be a better choice for production logging of your Rails applications.</text:p><text:p text:style-name="BL1"><text:tab/>•<text:tab/>Finer-grained control over logging levels and content.</text:p><text:p text:style-name="BL"><text:tab/>•<text:tab/>Consolidation of logger output for multiple Rails applications.</text:p><text:p text:style-name="BX"><text:tab/>•<text:tab/>If you’re using remote syslog capabilities of many systems, consolidation of logger output for multiple Rails application servers is possible. Contrast with having to handle individual log files on each application server box separately.</text:p><text:p text:style-name="IT">You can use Eric Hodel’s SyslogLogger<text:span text:style-name="T7">5</text:span> to interface your Rails application to <text:span text:style-name="CD1">syslog</text:span>. Setup will involve downloading the library, requiring it in your <text:span text:style-name="CD1">environment.rb</text:span> file, and replacing the <text:span text:style-name="CD1">RAILS_DEFAULT_LOGGER</text:span> instance.</text:p><text:p text:style-name="HC">Builtin Rails Info</text:p><text:p text:style-name="FT">The<office:annotation><dc:creator>Obie Fernandez</dc:creator><dc:date>2010-01-05T22:25:00</dc:date><text:p text:style-name="P20"><text:span text:style-name="T14">Please explain wtf a built-in is here, before launching into the rest. Might make sense to move into routes chapter.</text:span></text:p></office:annotation> only builtin that has ever existed is in <text:span text:style-name="CD1">railties/builtin/rails_info</text:span> and it isn’t particularly well-known, other than as the target of the “About your application’s environment” link on the default “Welcome Aboard” <text:span text:style-name="CD1">index.html</text:span> page that can be seen in a newly created Rails application.</text:p><text:p text:style-name="IT">To check it out, fire up any Rails application in development mode and go to http://localhost:3000/rails/info/properties via your browser. You’ll see a diagnostic screen with a dump of significant version numbers and settings that looks something like this:</text:p><text:p text:style-name="CDT1">Ruby version <text:s text:c="19"/>1.8.5 (i686-darwin8.8.1)</text:p><text:p text:style-name="CDT">RubyGems version <text:s text:c="15"/>0.9.0</text:p><text:p text:style-name="CDT">Rails version <text:s text:c="18"/>1.2.0</text:p><text:p text:style-name="CDT">Active Record version <text:s text:c="10"/>1.14.4</text:p><text:p text:style-name="CDT">Action Pack version <text:s text:c="12"/>1.12.5</text:p><text:p text:style-name="CDT">Action Web Service version <text:s text:c="5"/>1.1.6</text:p><text:p text:style-name="CDT">Action Mailer version <text:s text:c="10"/>1.2.5</text:p><text:p text:style-name="CDT">Active Support version <text:s text:c="9"/>1.3.1</text:p><text:p text:style-name="CDT">Edge Rails revision <text:s text:c="12"/>33</text:p><text:p text:style-name="CDT">Application root <text:s text:c="15"/>/Users/obie/prorails/time_and_expenses</text:p><text:p text:style-name="CDT">Environment <text:s text:c="20"/>development</text:p><text:p text:style-name="CDT">Database adapter <text:s text:c="15"/>mysql</text:p><text:p text:style-name="HC">Conclusion</text:p><text:p text:style-name="FT">We’ve kicked off our Rails journey by reviewing the different environments in which Rails executes and how it loads its dependencies, including your application code. An in-depth look at <text:span text:style-name="CD1">environment.rb</text:span> and its per-mode variants revealed how we can customize Rails behavior to our taste. In discussing the version of Rails libraries used for a particular project, we also had an opportunity to discuss running edge and whether it might make sense for your project.</text:p><text:p text:style-name="IT">We also learned about the Rails startup process by actually taking a peek at some of its source code. (Throughout the rest of the book, we’ll dive into Rails source code wherever it makes sense to do so.)</text:p><text:p text:style-name="IT">In Chapter 2, “Working with Controllers,” we continue our journey by delving into the Rails dispatcher and the <text:span text:style-name="CD1">ActionController</text:span> framework.</text:p><text:p text:style-name="HC">References</text:p><text:p text:style-name="FTNx"><text:tab/>1.<text:tab/>http://tzinfo.rubyforge.org/</text:p><text:p text:style-name="FTNx"><text:tab/>2.<text:tab/>www.ruby-forum.com/topic/79431</text:p><text:p text:style-name="FTNx"><text:tab/>3.<text:tab/>http://article.gmane.org/gmane.comp.lang.ruby.rails/75790</text:p><text:p text:style-name="FTNx"><text:tab/>4.<text:tab/>Practically every PHP application ever written has this problem.</text:p><text:p text:style-name="Comment_20_Text"><text:tab/>5.<text:tab/>http://seattlerb.rubyforge.org/SyslogLogger/</text:p></text:deletion></text:changed-region></text:tracked-changes><text:sequence-decls><text:sequence-decl text:display-outline-level="0" text:name="Illustration"/><text:sequence-decl text:display-outline-level="0" text:name="Table"/><text:sequence-decl text:display-outline-level="0" text:name="Text"/><text:sequence-decl text:display-outline-level="0" text:name="Drawing"/></text:sequence-decls><text:table-of-content text:style-name="Sect1" text:name="Table of Contents1"><text:table-of-content-source text:outline-level="10" text:use-outline-level="false" text:use-index-marks="false" text:use-index-source-styles="true"><text:index-title-template text:style-name="Contents_20_Heading"/><text:table-of-content-entry-template text:outline-level="1" text:style-name="Contents_20_1"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/></text:table-of-content-entry-template><text:table-of-content-entry-template text:outline-level="2" text:style-name="Contents_20_2"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/></text:table-of-content-entry-template><text:table-of-content-entry-template text:outline-level="3" text:style-name="Contents_20_3"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/></text:table-of-content-entry-template><text:table-of-content-entry-template text:outline-level="4" text:style-name="Contents_20_4"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/></text:table-of-content-entry-template><text:table-of-content-entry-template text:outline-level="5" text:style-name="Contents_20_5"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/></text:table-of-content-entry-template><text:table-of-content-entry-template text:outline-level="6" text:style-name="Contents_20_6"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/></text:table-of-content-entry-template><text:table-of-content-entry-template text:outline-level="7" text:style-name="Contents_20_7"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/></text:table-of-content-entry-template><text:table-of-content-entry-template text:outline-level="8" text:style-name="Contents_20_8"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/></text:table-of-content-entry-template><text:table-of-content-entry-template text:outline-level="9" text:style-name="Contents_20_9"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/></text:table-of-content-entry-template><text:table-of-content-entry-template text:outline-level="10" text:style-name="Contents_20_10"><text:index-entry-chapter/><text:index-entry-text/><text:index-entry-tab-stop style:type="right" style:leader-char="."/><text:index-entry-page-number/><text:index-entry-tab-stop style:type="left" style:position="5.1563in" style:leader-char="." style:with-tab="false"/></text:table-of-content-entry-template><text:index-source-styles text:outline-level="1"><text:index-source-style text:style-name="HA"/></text:index-source-styles><text:index-source-styles text:outline-level="2"><text:index-source-style text:style-name="HB"/></text:index-source-styles><text:index-source-styles text:outline-level="3"><text:index-source-style text:style-name="HC"/></text:index-source-styles></text:table-of-content-source><text:index-body><text:p text:style-name="P15">Chapter 1<text:tab/>1</text:p><text:p text:style-name="P16">Rails Environments and Configuration<text:tab/>1</text:p><text:p text:style-name="P17">Startup and Application Settings<text:tab/>1</text:p><text:p text:style-name="P17">Development Mode<text:tab/>9</text:p><text:p text:style-name="P17">Test Mode<text:tab/>12</text:p><text:p text:style-name="P17">Production Mode<text:tab/>12</text:p><text:p text:style-name="P17">Logging<text:tab/>13</text:p><text:p text:style-name="P17">Builtin Rails Info<text:tab/>18</text:p><text:p text:style-name="P17">Conclusion<text:tab/>19</text:p><text:p text:style-name="P17">References<text:tab/>19</text:p></text:index-body></text:table-of-content><text:p text:style-name="P19"/><text:p text:style-name="HA">Chapter 1</text:p><text:p text:style-name="HB">Rails Environments and Configuration</text:p><text:p text:style-name="EX">[Rails] gained a lot of its focus and appeal because I didn’t try to please people who didn’t share my problems. Differentiating between production and development was a very real problem for me, so I solved it the best way I knew how.<text:line-break/>—David Heinemeier Hansson</text:p><text:p text:style-name="FT">Rails applications are preconfigured with three standard modes of operation: <text:span text:style-name="T2">development</text:span>, <text:span text:style-name="T2">test</text:span>, and <text:span text:style-name="T2">production</text:span>. These modes are basically execution environments and have a collection of associated settings that determine things such as which database to connect to, and whether or not the classes of your application are reloaded with each request. It is also simple to create your own custom environments if necessary.</text:p><text:p text:style-name="IT">The current environment is always specified in the environment variable <text:span text:style-name="CD1">RAILS_ENV</text:span>, which names the desired mode of operation and corresponds to an environment definition file in the <text:span text:style-name="CD1">config/environments</text:span> folder. Since the environment settings govern some of the most fundamental aspects of Rails, such as classloading, in order to really understand the Rails way you should really understand its environment settings.</text:p><text:p text:style-name="IT">In this chapter, we get familiar with how Rails starts up and handles requests, by examining scripts such as <text:span text:style-name="CD1">boot.rb</text:span> and <text:span text:style-name="CD1">application.rb</text:span> and the settings that make up the three standard environment settings (modes). We also cover some of the basics of defining your own environments, and why you might choose to do so.</text:p><text:p text:style-name="HC">Startup and Application Settings</text:p><text:p text:style-name="FT">Whenever you start a process to handle requests with Rails (such as with <text:change text:change-id="ct533655504"/><text:change-start text:change-id="ct516710592"/><text:span text:style-name="CD1">rails </text:span><text:change-end text:change-id="ct516710592"/><text:span text:style-name="CD1">server), one of the first things that happens is that config/</text:span><text:change text:change-id="ct532862720"/><text:change-start text:change-id="ct624251312"/><text:span text:style-name="CD1">boot</text:span><text:change-end text:change-id="ct624251312"/><text:span text:style-name="CD1">.rb is loaded.</text:span><text:change text:change-id="ct533619008"/><text:change text:change-id="ct532958688"/><text:change text:change-id="ct535345760"/><text:change text:change-id="ct534830848"/><text:change text:change-id="ct532976080"/><text:change text:change-id="ct625038352"/><text:change text:change-id="ct533610896"/></text:p><text:p text:style-name="IT"><text:change text:change-id="ct624869168"/><text:change-start text:change-id="ct532976288"/><text:soft-page-break/>P<text:change-end text:change-id="ct532976288"/>rocesses <text:change-start text:change-id="ct533609344"/>require different components depending on what they need. <text:change-end text:change-id="ct533609344"/><text:change text:change-id="ct46013760"/><text:change-start text:change-id="ct45363712"/>Some processes<text:change-end text:change-id="ct45363712"/> <text:change-start text:change-id="ct533100192"/>need <text:change-end text:change-id="ct533100192"/>the <text:span text:style-name="T2">whole </text:span>Rails environment, <text:change-start text:change-id="ct625060240"/>so <text:change-end text:change-id="ct625060240"/><text:change-start text:change-id="ct533055456"/>they require <text:span text:style-name="CD1">config/environment.rb</text:span><text:change-end text:change-id="ct533055456"/><text:change-start text:change-id="ct532957600"/><text:span text:style-name="CD1">, you can see an example of that at the top of files such as </text:span><text:change-end text:change-id="ct532957600"/><text:change text:change-id="ct532962816"/><text:change-start text:change-id="ct624757920"/><text:span text:style-name="CD1">spec</text:span><text:change-end text:change-id="ct624757920"/><text:span text:style-name="CD1">/</text:span><text:change text:change-id="ct532963008"/><text:change-start text:change-id="ct533683552"/><text:span text:style-name="CD1">spec</text:span><text:change-end text:change-id="ct533683552"/><text:span text:style-name="CD1">_helper.rb.</text:span></text:p><text:p text:style-name="HD">application.rb</text:p><text:p text:style-name="FT">The file <text:span text:style-name="CD1">environment.rb</text:span> used to be where many of your application settings lived. In Rails 3, the settings move to a file called <text:span text:style-name="CD1">application.rb</text:span>, and it’s the only file required at the top of <text:span text:style-name="CD1">environment.rb</text:span>.</text:p><text:p text:style-name="FT">Let’s go step by step through the settings provided in the default <text:span text:style-name="CD1">application.rb</text:span> file that you’ll find in a newly created Rails application. By the way, as you’re reading through the following sections, make a mental note to yourself that changes to these files require a server restart to take effect.</text:p><text:p text:style-name="HD">boot.rb</text:p><text:p text:style-name="FT">The next lines of <text:span text:style-name="CD1">application.rb</text:span> are where the wheels really start turning, once <text:span text:style-name="CD1">config/boot.rb</text:span> is loaded:</text:p><text:p text:style-name="CDT">require File.expand_path(&apos;../boot&apos;, __FILE__)</text:p><text:p text:style-name="IT">Note that the boot script is generated as part of your Rails application, but you won’t usually need to edit it. It takes care of a two essential steps in starting up the environment:</text:p><text:list xml:id="list1843469566" text:style-name="WW8Num1"><text:list-item><text:p text:style-name="P8">Require gems required by Rails and your application according to its Bundler configuration</text:p></text:list-item><text:list-item><text:p text:style-name="P8">Require the Rails component frameworks.</text:p></text:list-item></text:list><text:p text:style-name="IT">Usually, the following line (default) will suffice:</text:p><text:p text:style-name="CDTX">require &apos;rails/all&apos;</text:p><text:p text:style-name="IT">However, a new feature of Rails 3 is the ability to easily cherry-pick only the components needed by your application.</text:p><text:p text:style-name="CDT1"># To pick the frameworks you want, remove &apos;require &quot;rails/all&quot;&apos;</text:p><text:p text:style-name="CDT"># and list the framework railties that you want:</text:p><text:p text:style-name="CDT">#</text:p><text:p text:style-name="CDT"># require &quot;active_model/railtie&quot;</text:p><text:p text:style-name="CDT"># require &quot;active_record/railtie&quot;</text:p><text:p text:style-name="CDT"># require &quot;action_controller/railtie&quot;</text:p><text:p text:style-name="CDT"># require &quot;action_view/railtie&quot;</text:p><text:p text:style-name="CDT"># require &quot;action_mailer/railtie&quot;</text:p><text:p text:style-name="CDTX"># require &quot;active_resource/railtie&quot;<text:change text:change-id="ct538565328"/><text:change text:change-id="ct532863456"/><text:change text:change-id="ct538063456"/><text:change text:change-id="ct565961344"/><text:change text:change-id="ct533049792"/><text:change text:change-id="ct535359344"/><text:change text:change-id="ct625003648"/><text:change text:change-id="ct533051504"/><text:change text:change-id="ct533623456"/><text:change text:change-id="ct565962976"/><text:change text:change-id="ct45363616"/><text:change text:change-id="ct624991440"/></text:p></office:text></office:body></office:document-content>